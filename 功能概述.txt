功能概述
为了让“角色创建”过程更高效、便捷，新增“AI 智能填充”功能：
 在所有可编辑的文本框（文本输入框、文本区域）右侧添加一个“骰子”按钮，用户点击即可向 AI 服务发送请求，AI 根据已填写的信息（上下文）生成该栏位的合理内容并自动填入。用户可以多次点击 “骰子” 循环生成不同版本的文本。

1.触发条件与适用范围
2.适用页面
￮基于现有的三大选项卡结构：
▪基础信息（Basic）
▪核心设定（Core）
▪高级设定（Advanced）
￮针对上述三个选项卡中所有需要用户主动输入自由文本的字段（包括单行 Input 和多行 Textarea），都将右侧显示一个骰子图标，允许 AI 填充。
3.触发时机
￮用户鼠标悬浮或聚焦到某个可输入字段时，输入框右侧出现“骰子”图标（始终可见或仅在 Hover/Focus 时高亮均可，具体可与 UI 设计保持一致）。
￮当用户点击骰子时，进行一次向 AI 服务的请求。
4.上下文来源
 每次发起 AI 填充请求时，将携带用户至当前时刻已填写的所有字段值，作为生成当前栏位内容的上下文输入。
￮例如：要生成“性格”栏位时，会将 “语言”、“名称”、“外貌”等前面已填写内容一并传给 AI 服务。
￮若某些字段尚未填写，AI 也可基于现有信息进行合理补全。

5.用户流程与交互细节
3.1 在输入框右侧显示“骰子”图标
•位置：每个可输入文本域（单行/多行）右侧内侧对齐。
•样式：小型灰色骰子图标（与整体水蜜桃粉主题保持和谐），Hover 时加深色或带有轻微阴影。
•显示时机：
￮默认可见：字段处于非禁用状态（无论是否聚焦），骰子图标始终显示。
￮聚焦/Hover 高亮：当用户将鼠标悬浮到该字段或获得焦点时，骰子图标由半透明提升到 100% 不透明，便于点击。
3.2 点击“骰子”后的交互
1.点击反馈
￮骰子按钮按下时，立即出现一个小型加载指示（可以在骰子图标上覆盖一个旋转的 loading Spinner）。
￮同时，整行输入框（或多行容器）出现轻微 “抖动” 动画或高亮边框，表示 AI 正在生成内容。
2.发送请求
￮在前端向后端 AI 接口发起异步请求，Payload 包含：
▪目标字段标识（如 role_personality）
▪当前表单上下文：已填写的所有字段键值对
▪模型参数：如温度（可统一或可在后续版本中开放给用户调节）、最大 Tokens 限制（留作服务端配置）
￮请求发出后，骰子保持 loading 动画，按钮不可再点（直到 AI 返回）。
3.接收响应
￮AI 返回 text 字段：生成的内容字符串。
￮前端中断 loading，将生成内容填入对应输入框。
￮如果返回的内容长度超过输入框最大可见字符或者含有换行，多行文本框应自动撑开（或出现滚动条），单行输入框可截断或提示“文字过长，请自行调整”。
￮若 AI 返回为空或出错，弹出一个简洁的 Toast 提示（“AI 生成失败，请重试”），骰子恢复可点击状态。
4.重复点击
￮当 AI 返回后，骰子恢复可点击状态。
￮用户可再次点击骰子，发起新的 AI 请求。每次都基于最新的“上下文”（包括本字段与其他已填字段）生成新的文本，覆盖原先值。

5.各字段适用说明
以下列出每个选项卡下的所有可填写字段，以及点击骰子后 AI 要生成的预期内容类型／示例。
4.1 基础信息（Basic）

点击图片可查看完整电子表格
备注：
•“角色头像”“角色常用语言”“角色语音” 不提供 AI 填充。
•只有文本输入框或多行文本框才可贴骰子。
4.2 核心设定（Core）

点击图片可查看完整电子表格
备注：
•上述三大核心必填项必须填写（AI 生成也能满足必填）。
•“口癖”“开场白”“与用户的关系”同属于“语言习惯”范畴，但 UI 当前在 Core 中可先展示，方便整体预览。
4.3 高级设定（Advanced）

点击图片可查看完整电子表格
备注：
•“世界观”“补充设定”均可由 AI 一键补全整体大纲。
•“示例话语”最多三条，用户可重复点击骰子刷新其中任意一条，也可一条一条分别生成。

6.后端交互规范
5.1 接口定义
•接口地址：POST /api/ai/generate-field
•请求 Header：
￮Content-Type: application/json
￮Authorization: Bearer <用户 Token>（如已登录则带，否则视为游客，可适当限制频次）
•请求体示例（JSON）：
•jsonc
•复制编辑
•{
  "field": "personality",            // 当前需要生成的字段名（key）
  "context": {
    "language": "中文",
    "name": "月影",
    "gender": "女",
    "age": "24",
    "birthday": "2001-04-16",
    "mbti": "INFJ",
    "bloodType": "A",
    "stance": "守序善良",
    "appearance": "身材娇小，银发碧眸，常穿黑色长袍",
    "identity": "魔法学院的资深学生",
    "catchphrase": "冰冷如霜",
    "greeting": "早安，主人",
    "userRelation": "仆人",
    "supplemental": "擅长炼金术，对于药剂制作有极高天赋",
    "world": "暮光大陆，被魔法与蒸汽技术共存的王国",
    "examples": ["我可不是你想象中的软弱。"]
  },
  "maxTokens": 200,                  // 建议字段：控制返回文字长度
  "temperature": 0.8                 // 建议字段：控制生成的随机性
}
•响应体示例（JSON）：
•jsonc
•复制编辑
•{
  "success": true,
  "generatedText": "她性格沉稳内敛，但拥有强烈的正义感，重视友情，易为他人着想，言语冷淡却在关键时刻会展现温柔。",
  "field": "personality"
}
￮若失败，success: false，并附带 errorMessage。
5.2 上下文传递规则
•完整上下文：请求中 context 字段请包含当前已有form状态中的所有属性（已填或空字符串都可传）
￮后端 AI 服务可结合已有输入内容做“增量”生成或“整体”补全。
•动态覆盖：若用户先前曾由 AI 生成过该栏位内容，则每次再点击骰子均要将最新栏位值也放入 context，以便 AI 在“更新”语境中做迭代。
5.3 频次限制与降级策略
•频次限制：每个用户在短时间内（例如 1 分钟内）对同一字段请求次数不得超过 5 次，防止滥用。
•流量控制：后端可对并发请求做排队或限速，若超过阈值，返回 429 Too Many Requests，前端需捕获并提示“请求过于频繁，请稍后再试”。
•降级策略：
￮若 AI 服务短暂不可用或出现网络故障，骰子点击后直接弹出“AI 服务暂不可用，请稍后重试”提示，并保留当前文本内容不变。
￮不影响用户手动填写。

1.前端实现思路（高层次，不含代码）
2.UI 元素
￮为每个可填写字段（FullInput / FullTextarea）右侧追加一个骰子图标 <DiceIcon />。可通过 CSS position: absolute 或 Flex 布局完成图标嵌入。
￮当光标聚焦或鼠标悬停时，提高图标可见度。
3.状态管理
￮为每个字段维护一个“加载中”状态，例如：loadingFields: { [key: string]: boolean }。
￮点击骰子前检查 loadingFields[field]，若为 true，则拒绝重复点击。
4.事件处理流程
￮用户点击骰子 → 将 loadingFields[field] = true → 显示 loading 动画 → 组装当前 form 上下文 → 调用 await fetch('/api/ai/generate-field', { … })
￮接收生成文本后：
▪成功：更新 form[field] = generatedText → loadingFields[field] = false → 隐藏 loading。
▪失败：弹出错信息 → loadingFields[field] = false → 隐藏 loading。
5.表单校验与交互
￮不论 AI 填充还是手动输入，只要用户修改了该输入框的值，都要触发 update(field, newValue) 更新到 form。
￮requiredFilled 的计算逻辑保持不变，AI 生成也能帮助用户快速满足必填项。
￮“保存”按钮启用／禁用逻辑不变。
6.用户体验细节
￮每次 AI 填充完成后，将自动滚动到该输入框（尤其是在多行页面滚动时），确保用户看到生成结果。
￮如果 AI 文本长度非常长，文本框会自动扩大到最大高度，超出部分出现滚动条。

1.流程示例（以“性格”字段为例）
2.用户在“基础信息”输入了：
￮角色名称：月影
￮性别：女
￮语言：中文
￮立场：守序善良
3.切换到“核心设定”选项卡，光标聚焦到“性格”多行框，右侧骰子图标高亮。
4.点击骰子，页面局部高亮并出现 loading 动画。
5.前端发起 POST 请求，Payload 中包含当前 form 所有字段。
6.AI 返回一段中文性格描述。前端将其填入“性格”文本域，loading 结束。
7.用户如果不满意，可再次点击骰子，触发新一轮 AI 填充，覆盖之前内容。

1.骰子图标示意
•正常态：
￮颜色：灰色（#A0A0A0）
￮大小：20×20 像素，与字体大小保持一致
￮悬浮态：颜色加深到粉色(text-pink-400)，以示可点击
•加载态：
￮图标位置不变，内部替换为微型 Spinner，环绕旋转
￮输入框边框颜色切换到粉色渐变，提示正在生成

1.潜在扩展
2.模型参数可配置
￮在页面右上角或设置中增加一个“AI 参数”面板，让资深用户调整温度、最大 Tokens。
3.历史记录与撤销
￮每次 AI 填充可记录一次历史，按钮旁添加“撤销”图标，允许用户一键回到填空前状态。
4.多语言支持
￮基于 form.language 字段，在提交给 AI 时传递目标语种，AI 返回同时符合该语种的文本。
5.缓存机制
￮对于同一上下文与同一字段的请求，若短期内重复发起，可从本地缓存中读取上次结果，加快响应。

1.验收与测试要点
2.功能测试
￮每个可填字段的骰子图标均正常可见、可点击。
￮点击时请求发送、加载动画、返回后文本正确填入。
￮多次点击可刷新内容，且不会重复叠加文本。
￮当上下文变化（如用户修改了“名称”后再点“性格”），AI 请求带新上下文。
3.边界测试
￮字段为空时点击骰子（上下文较少），AI 生成结果是否合理／提示短缺信息。
￮当 AI 服务返回空字符串或报错，前端能给出用户可理解的失败提示。
￮并发点击或频次过高是否触发限速提示。
4.UI/UX 测试
￮骰子在各种分辨率、触摸设备上是否易点击。
￮文本过长时的排版是否保持整洁。
￮在翻页（切换选项卡）后，之前生成的内容是否保留。
5.性能及监控
￮每次请求时间不超过 2s，加载动画流畅。
对用户 AI 填充次数做埋点统计，便于后续收敛模型可用性。